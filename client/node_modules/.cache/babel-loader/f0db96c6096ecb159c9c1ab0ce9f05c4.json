{"ast":null,"code":"import _regeneratorRuntime from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Icon,InputLeftElement,Modal,ModalBody,ModalCloseButton,ModalContent,ModalHeader,ModalOverlay,Progress,Text,useDisclosure}from\"@chakra-ui/react\";import{sendMessage}from\"api/handler/messages\";import StyledTooltip from\"components/sections/StyledTooltip\";import React,{useRef,useState}from\"react\";import{MdAddCircle}from\"react-icons/md\";import{useParams}from\"react-router-dom\";import{FileSchema}from\"validation/message.schema\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function FileUploadButton(){var _useParams=useParams(),channelId=_useParams.channelId;var _useDisclosure=useDisclosure(),isOpen=_useDisclosure.isOpen,onOpen=_useDisclosure.onOpen,onClose=_useDisclosure.onClose;var inputFile=useRef(null);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isSubmitting=_useState2[0],setSubmitting=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),progress=_useState4[0],setProgress=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),errors=_useState6[0],setErrors=_useState6[1];var closeModal=function closeModal(){setErrors({});setProgress(0);onClose();};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(file){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(file){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setSubmitting(true);_context.prev=3;_context.next=6;return FileSchema.validate({file:file});case 6:_context.next=13;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](3);setErrors(_context.t0.errors);onOpen();return _context.abrupt(\"return\");case 13:data=new FormData();data.append(\"file\",file);_context.next=17;return sendMessage(channelId,data,function(event){var loaded=Math.round(100*event.loaded/event.total);setProgress(loaded);if(loaded>=100)setProgress(0);});case 17:case\"end\":return _context.stop();}}},_callee,null,[[3,8]]);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(InputLeftElement,{color:\"iconColor\",_hover:{cursor:\"pointer\",color:\"#fcfcfc\"},onClick:function onClick(){return inputFile.current.click();},children:[/*#__PURE__*/_jsx(Icon,{as:MdAddCircle,boxSize:\"20px\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:inputFile,hidden:true,disabled:isSubmitting,onChange:/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(e.currentTarget.files){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:handleSubmit(e.currentTarget.files[0]).then(function(){setSubmitting(false);e.target.value=\"\";});case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}()}),errors&&/*#__PURE__*/_jsxs(Modal,{size:\"sm\",isOpen:isOpen,onClose:closeModal,isCentered:true,children:[/*#__PURE__*/_jsx(ModalOverlay,{}),/*#__PURE__*/_jsxs(ModalContent,{bg:\"brandGray.light\",textAlign:\"center\",children:[/*#__PURE__*/_jsx(ModalHeader,{pb:\"0\",children:\"Error Uploading File\"}),/*#__PURE__*/_jsx(ModalCloseButton,{}),/*#__PURE__*/_jsxs(ModalBody,{children:[/*#__PURE__*/_jsxs(Text,{mb:\"2\",children:[\"Reason: \",errors]}),/*#__PURE__*/_jsx(Text,{children:\"Max file size is 5.00 MB\"}),/*#__PURE__*/_jsx(Text,{children:\"Only Images and mp3 allowed\"})]})]})]}),progress>0&&/*#__PURE__*/_jsx(Modal,{size:\"sm\",isOpen:progress>0,closeOnOverlayClick:false,onClose:closeModal,isCentered:true,children:/*#__PURE__*/_jsxs(ModalContent,{bg:\"brandGray.darker\",textAlign:\"center\",children:[/*#__PURE__*/_jsx(ModalHeader,{pb:\"0\",children:\"Upload Progress\"}),/*#__PURE__*/_jsx(ModalBody,{children:/*#__PURE__*/_jsx(Progress,{hasStripe:true,isAnimated:true,value:progress})})]})})]});}","map":{"version":3,"sources":["/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/src/components/layouts/guild/chat/FileUploadButton.js"],"names":["Icon","InputLeftElement","Modal","ModalBody","ModalCloseButton","ModalContent","ModalHeader","ModalOverlay","Progress","Text","useDisclosure","sendMessage","StyledTooltip","React","useRef","useState","MdAddCircle","useParams","FileSchema","FileUploadButton","channelId","isOpen","onOpen","onClose","inputFile","isSubmitting","setSubmitting","progress","setProgress","errors","setErrors","closeModal","handleSubmit","file","validate","data","FormData","append","event","loaded","Math","round","total","cursor","color","current","click","e","currentTarget","files","then","target","value"],"mappings":"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","sourcesContent":["import {\n  Icon,\n  InputLeftElement,\n  Modal,\n  ModalBody,\n  ModalCloseButton,\n  ModalContent,\n  ModalHeader,\n  ModalOverlay,\n  Progress,\n  Text,\n  useDisclosure,\n} from \"@chakra-ui/react\";\nimport { sendMessage } from \"api/handler/messages\";\nimport StyledTooltip from \"components/sections/StyledTooltip\";\nimport React, { useRef, useState } from \"react\";\nimport { MdAddCircle } from \"react-icons/md\";\nimport { useParams } from \"react-router-dom\";\nimport { FileSchema } from \"validation/message.schema\";\n\nexport default function FileUploadButton() {\n  const { channelId } = useParams();\n  const { isOpen, onOpen, onClose } = useDisclosure();\n\n  const inputFile = useRef(null);\n  const [isSubmitting, setSubmitting] = useState(false);\n  const [progress, setProgress] = useState(0);\n  const [errors, setErrors] = useState({});\n\n  const closeModal = () => {\n    setErrors({});\n    setProgress(0);\n    onClose();\n  };\n\n  const handleSubmit = async (file) => {\n    if (!file) return;\n    setSubmitting(true);\n\n    try {\n      await FileSchema.validate({ file });\n    } catch (err) {\n      setErrors(err.errors);\n      onOpen();\n      return;\n    }\n\n    const data = new FormData();\n    data.append(\"file\", file);\n    await sendMessage(channelId, data, (event) => {\n      const loaded = Math.round((100 * event.loaded) / event.total);\n      setProgress(loaded);\n      if (loaded >= 100) setProgress(0);\n    });\n  };\n\n  return (\n    <InputLeftElement\n      color={\"iconColor\"}\n      _hover={{ cursor: \"pointer\", color: \"#fcfcfc\" }}\n      onClick={() => inputFile.current.click()}\n    >\n      <Icon as={MdAddCircle} boxSize={\"20px\"} />\n      <input\n        type=\"file\"\n        ref={inputFile}\n        hidden\n        disabled={isSubmitting}\n        onChange={async (e) => {\n          if (!e.currentTarget.files) return;\n          handleSubmit(e.currentTarget.files[0]).then(() => {\n            setSubmitting(false);\n            e.target.value = \"\";\n          });\n        }}\n      />\n      {errors && (\n        <Modal size=\"sm\" isOpen={isOpen} onClose={closeModal} isCentered>\n          <ModalOverlay />\n          <ModalContent bg=\"brandGray.light\" textAlign=\"center\">\n            <ModalHeader pb=\"0\">Error Uploading File</ModalHeader>\n            <ModalCloseButton />\n            <ModalBody>\n              <Text mb=\"2\">Reason: {errors}</Text>\n              <Text>Max file size is 5.00 MB</Text>\n              <Text>Only Images and mp3 allowed</Text>\n            </ModalBody>\n          </ModalContent>\n        </Modal>\n      )}\n      {progress > 0 && (\n        <Modal\n          size=\"sm\"\n          isOpen={progress > 0}\n          closeOnOverlayClick={false}\n          onClose={closeModal}\n          isCentered\n        >\n          <ModalContent bg=\"brandGray.darker\" textAlign=\"center\">\n            <ModalHeader pb=\"0\">Upload Progress</ModalHeader>\n            <ModalBody>\n              <Progress hasStripe isAnimated value={progress} />\n            </ModalBody>\n          </ModalContent>\n        </Modal>\n      )}\n    </InputLeftElement>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}