{"ast":null,"code":"import _regeneratorRuntime from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Flex,GridItem,InputGroup,Text,Textarea}from\"@chakra-ui/react\";import getSocket from\"api/getSocket\";import{sendMessage}from\"api/handler/messages\";import React,{useRef,useState}from\"react\";import{useQuery}from\"react-query\";import{useParams}from\"react-router-dom\";import ResizeTextarea from\"react-textarea-autosize\";import channelStore from\"stores/channelStore\";import userStore from\"stores/userStore\";import{cKey,dmKey}from\"utils/querykeys\";import\"../css/MessageInput.css\";import FileUploadButton from\"./FileUploadButton\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function MessageInput(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isSubmitting=_useState4[0],setSubmitting=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),currentlyTyping=_useState6[0],setCurrentlyTyping=_useState6[1];var inputRef=useRef();var _useParams=useParams(),guildId=_useParams.guildId,channelId=_useParams.channelId;var qKey=guildId===undefined?dmKey:cKey(guildId);var _useQuery=useQuery(qKey),data=_useQuery.data;var channel=data===null||data===void 0?void 0:data.find(function(c){return c.id===channelId;});var socket=getSocket();var current=userStore(function(state){return state.current;});var isTyping=channelStore(function(state){return state.typing;});function handleAddMessage(_x){return _handleAddMessage.apply(this,arguments);}function _handleAddMessage(){_handleAddMessage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var _inputRef$current,_data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(event.key===\"Enter\")){_context.next=13;break;}if(!(!text||!text.trim())){_context.next=3;break;}return _context.abrupt(\"return\");case 3:socket.emit(\"stopTyping\",channelId,current===null||current===void 0?void 0:current.username);setSubmitting(true);setCurrentlyTyping(false);_data=new FormData();_data.append(\"text\",text.trim());_context.next=10;return sendMessage(channelId,_data);case 10:setText(\"\");setSubmitting(false);inputRef===null||inputRef===void 0?void 0:(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();case 13:case\"end\":return _context.stop();}}},_callee);}));return _handleAddMessage.apply(this,arguments);}var getTypingString=function getTypingString(members){switch(members.length){case 1:return members[0];case 2:return\"\".concat(members[0],\" and \").concat(members[1]);case 3:return\"\".concat(members[0],\", \").concat(members[1],\" and \").concat(members[2]);default:return\"Several people\";}};function handleMessageChange(event){var value=event.target.value;if(value.trim().length===1&&!currentlyTyping){socket.emit(\"startTyping\",channelId,current===null||current===void 0?void 0:current.username);setCurrentlyTyping(true);}else if(value.length===0){socket.emit(\"stopTyping\",channelId,current===null||current===void 0?void 0:current.username);setCurrentlyTyping(false);}if(value.length<=2000)setText(value);}var getPlaceholder=function getPlaceholder(){if(channel===null||channel===void 0?void 0:channel.user){return\"Message @\".concat(channel===null||channel===void 0?void 0:channel.user.username);}return\"Message #\".concat(channel===null||channel===void 0?void 0:channel.name);};return/*#__PURE__*/_jsxs(GridItem,{gridColumn:3,gridRow:3,px:\"20px\",pb:isTyping.length>0?\"0\":\"26px\",bg:\"brandGray.light\",children:[/*#__PURE__*/_jsxs(InputGroup,{size:\"md\",bg:\"messageInput\",alignItems:\"center\",borderRadius:\"8px\",children:[/*#__PURE__*/_jsx(Textarea,{as:ResizeTextarea,minH:\"40px\",transition:\"height none\",overflow:\"hidden\",w:\"100%\",resize:\"none\",minRows:1,pl:\"3rem\",name:\"text\",placeholder:getPlaceholder(),border:\"0\",_focus:{border:\"0\"},ref:inputRef,isDisabled:isSubmitting,value:text,onChange:handleMessageChange,onKeyDown:handleAddMessage}),/*#__PURE__*/_jsx(FileUploadButton,{})]}),isTyping.length>0&&/*#__PURE__*/_jsxs(Flex,{align:\"center\",fontSize:\"12px\",my:1,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"typing-indicator\",children:[/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{}),/*#__PURE__*/_jsx(\"span\",{})]}),/*#__PURE__*/_jsx(Text,{ml:\"1\",fontWeight:\"semibold\",children:getTypingString(isTyping)}),/*#__PURE__*/_jsxs(Text,{ml:\"1\",children:[isTyping.length===1?\"is\":\"are\",\" typing...\",\" \"]})]})]});}","map":{"version":3,"sources":["/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/src/components/layouts/guild/chat/MessageInput.js"],"names":["Flex","GridItem","InputGroup","Text","Textarea","getSocket","sendMessage","React","useRef","useState","useQuery","useParams","ResizeTextarea","channelStore","userStore","cKey","dmKey","FileUploadButton","MessageInput","text","setText","isSubmitting","setSubmitting","currentlyTyping","setCurrentlyTyping","inputRef","guildId","channelId","qKey","undefined","data","channel","find","c","id","socket","current","state","isTyping","typing","handleAddMessage","event","key","trim","emit","username","FormData","append","focus","getTypingString","members","length","handleMessageChange","value","target","getPlaceholder","user","name","border"],"mappings":"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","sourcesContent":["import { Flex, GridItem, InputGroup, Text, Textarea } from \"@chakra-ui/react\";\nimport getSocket from \"api/getSocket\";\nimport { sendMessage } from \"api/handler/messages\";\nimport React, { useRef, useState } from \"react\";\nimport { useQuery } from \"react-query\";\nimport { useParams } from \"react-router-dom\";\nimport ResizeTextarea from \"react-textarea-autosize\";\nimport channelStore from \"stores/channelStore\";\nimport userStore from \"stores/userStore\";\nimport { cKey, dmKey } from \"utils/querykeys\";\nimport \"../css/MessageInput.css\";\nimport FileUploadButton from \"./FileUploadButton\";\n\nexport default function MessageInput() {\n  const [text, setText] = useState(\"\");\n  const [isSubmitting, setSubmitting] = useState(false);\n  const [currentlyTyping, setCurrentlyTyping] = useState(false);\n  const inputRef = useRef();\n\n  const { guildId, channelId } = useParams();\n  const qKey = guildId === undefined ? dmKey : cKey(guildId);\n  const { data } = useQuery(qKey);\n  const channel = data?.find((c) => c.id === channelId);\n\n  const socket = getSocket();\n  const current = userStore((state) => state.current);\n  const isTyping = channelStore((state) => state.typing);\n\n  async function handleAddMessage(event) {\n    if (event.key === \"Enter\") {\n      if (!text || !text.trim()) return;\n      socket.emit(\"stopTyping\", channelId, current?.username);\n      setSubmitting(true);\n      setCurrentlyTyping(false);\n      const data = new FormData();\n      data.append(\"text\", text.trim());\n      await sendMessage(channelId, data);\n      setText(\"\");\n      setSubmitting(false);\n      inputRef?.current?.focus();\n    }\n  }\n\n  const getTypingString = (members) => {\n    switch (members.length) {\n      case 1:\n        return members[0];\n      case 2:\n        return `${members[0]} and ${members[1]}`;\n      case 3:\n        return `${members[0]}, ${members[1]} and ${members[2]}`;\n      default:\n        return \"Several people\";\n    }\n  };\n\n  function handleMessageChange(event) {\n    const value = event.target.value;\n    if (value.trim().length === 1 && !currentlyTyping) {\n      socket.emit(\"startTyping\", channelId, current?.username);\n      setCurrentlyTyping(true);\n    } else if (value.length === 0) {\n      socket.emit(\"stopTyping\", channelId, current?.username);\n      setCurrentlyTyping(false);\n    }\n    if (value.length <= 2000) setText(value);\n  }\n\n  const getPlaceholder = () => {\n    if (channel?.user) {\n      return `Message @${channel?.user.username}`;\n    }\n    return `Message #${channel?.name}`;\n  };\n\n  return (\n    <GridItem\n      gridColumn={3}\n      gridRow={3}\n      px=\"20px\"\n      pb={isTyping.length > 0 ? \"0\" : \"26px\"}\n      bg=\"brandGray.light\"\n    >\n      <InputGroup\n        size=\"md\"\n        bg=\"messageInput\"\n        alignItems=\"center\"\n        borderRadius=\"8px\"\n      >\n        <Textarea\n          as={ResizeTextarea}\n          minH=\"40px\"\n          transition=\"height none\"\n          overflow=\"hidden\"\n          w=\"100%\"\n          resize=\"none\"\n          minRows={1}\n          pl=\"3rem\"\n          name={\"text\"}\n          placeholder={getPlaceholder()}\n          border=\"0\"\n          _focus={{ border: \"0\" }}\n          ref={inputRef}\n          isDisabled={isSubmitting}\n          value={text}\n          onChange={handleMessageChange}\n          onKeyDown={handleAddMessage}\n        />\n        <FileUploadButton />\n      </InputGroup>\n      {isTyping.length > 0 && (\n        <Flex align={\"center\"} fontSize={\"12px\"} my={1}>\n          <div className=\"typing-indicator\">\n            <span />\n            <span />\n            <span />\n          </div>\n          <Text ml={\"1\"} fontWeight={\"semibold\"}>\n            {getTypingString(isTyping)}\n          </Text>\n          <Text ml={\"1\"}>\n            {isTyping.length === 1 ? \"is\" : \"are\"} typing...{\" \"}\n          </Text>\n        </Flex>\n      )}\n    </GridItem>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}