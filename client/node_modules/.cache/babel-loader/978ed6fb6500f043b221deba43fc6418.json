{"ast":null,"code":"import _toConsumableArray from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{useEffect}from\"react\";import getSocket from\"../getSocket\";import{useQueryClient}from\"react-query\";import userStore from\"stores/userStore\";import{dmKey}from\"utils/querykeys\";export default function useDMSocket(){var current=userStore(function(state){return state.current;});var cache=useQueryClient();useEffect(function(){var socket=getSocket();socket.emit(\"joinUser\",current===null||current===void 0?void 0:current.id);socket.on(\"push_to_top\",function(dmId){cache.setQueryData(dmKey,function(data){var index=data===null||data===void 0?void 0:data.findIndex(function(d){return d.id===dmId;});if(index===0||index===-1)return _toConsumableArray(data);var dm=data[index];return[dm].concat(_toConsumableArray(data.filter(function(d){return d.id!==dmId;})));});});return function(){socket.emit(\"leaveRoom\",current===null||current===void 0?void 0:current.id);socket.disconnect();};},[current,cache]);}","map":{"version":3,"sources":["/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/src/api/ws/useDMSocket.js"],"names":["useEffect","getSocket","useQueryClient","userStore","dmKey","useDMSocket","current","state","cache","socket","emit","id","on","dmId","setQueryData","data","index","findIndex","d","dm","filter","disconnect"],"mappings":"4MAAA,OAASA,SAAT,KAA0B,OAA1B,CACA,MAAOC,CAAAA,SAAP,KAAsB,cAAtB,CACA,OAASC,cAAT,KAA+B,aAA/B,CACA,MAAOC,CAAAA,SAAP,KAAsB,kBAAtB,CACA,OAASC,KAAT,KAAsB,iBAAtB,CAEA,cAAe,SAASC,CAAAA,WAAT,EAAuB,CACpC,GAAMC,CAAAA,OAAO,CAAGH,SAAS,CAAC,SAACI,KAAD,QAAWA,CAAAA,KAAK,CAACD,OAAjB,EAAD,CAAzB,CACA,GAAME,CAAAA,KAAK,CAAGN,cAAc,EAA5B,CAEAF,SAAS,CAAC,UAAM,CACd,GAAMS,CAAAA,MAAM,CAAGR,SAAS,EAAxB,CACAQ,MAAM,CAACC,IAAP,CAAY,UAAZ,CAAwBJ,OAAxB,SAAwBA,OAAxB,iBAAwBA,OAAO,CAAEK,EAAjC,EAEAF,MAAM,CAACG,EAAP,CAAU,aAAV,CAAyB,SAACC,IAAD,CAAU,CACjCL,KAAK,CAACM,YAAN,CAAmBV,KAAnB,CAA0B,SAACW,IAAD,CAAU,CAClC,GAAMC,CAAAA,KAAK,CAAGD,IAAH,SAAGA,IAAH,iBAAGA,IAAI,CAAEE,SAAN,CAAgB,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACP,EAAF,GAASE,IAAhB,EAAhB,CAAd,CACA,GAAIG,KAAK,GAAK,CAAV,EAAeA,KAAK,GAAK,CAAC,CAA9B,CAAiC,0BAAWD,IAAX,EACjC,GAAMI,CAAAA,EAAE,CAAGJ,IAAI,CAACC,KAAD,CAAf,CACA,OAAQG,EAAR,4BAAeJ,IAAI,CAACK,MAAL,CAAY,SAACF,CAAD,QAAOA,CAAAA,CAAC,CAACP,EAAF,GAASE,IAAhB,EAAZ,CAAf,GACD,CALD,EAMD,CAPD,EASA,MAAO,WAAM,CACXJ,MAAM,CAACC,IAAP,CAAY,WAAZ,CAAyBJ,OAAzB,SAAyBA,OAAzB,iBAAyBA,OAAO,CAAEK,EAAlC,EACAF,MAAM,CAACY,UAAP,GACD,CAHD,CAID,CAjBQ,CAiBN,CAACf,OAAD,CAAUE,KAAV,CAjBM,CAAT,CAkBD","sourcesContent":["import { useEffect } from \"react\";\nimport getSocket from \"../getSocket\";\nimport { useQueryClient } from \"react-query\";\nimport userStore from \"stores/userStore\";\nimport { dmKey } from \"utils/querykeys\";\n\nexport default function useDMSocket() {\n  const current = userStore((state) => state.current);\n  const cache = useQueryClient();\n\n  useEffect(() => {\n    const socket = getSocket();\n    socket.emit(\"joinUser\", current?.id);\n\n    socket.on(\"push_to_top\", (dmId) => {\n      cache.setQueryData(dmKey, (data) => {\n        const index = data?.findIndex((d) => d.id === dmId);\n        if (index === 0 || index === -1) return [...data];\n        const dm = data[index];\n        return [dm, ...data.filter((d) => d.id !== dmId)];\n      });\n    });\n\n    return () => {\n      socket.emit(\"leaveRoom\", current?.id);\n      socket.disconnect();\n    };\n  }, [current, cache]);\n}\n"]},"metadata":{},"sourceType":"module"}