{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport getSocket from \"../getSocket\";\nimport { useQueryClient } from \"react-query\";\nimport userStore from \"stores/userStore\";\nimport { dmKey } from \"utils/querykeys\";\nexport default function useDMSocket() {\n  _s();\n\n  const current = userStore(state => state.current);\n  const cache = useQueryClient();\n  useEffect(() => {\n    const socket = getSocket();\n    socket.emit(\"joinUser\", current === null || current === void 0 ? void 0 : current.id);\n    socket.on(\"push_to_top\", dmId => {\n      cache.setQueryData(dmKey, data => {\n        const index = data === null || data === void 0 ? void 0 : data.findIndex(d => d.id === dmId);\n        if (index === 0 || index === -1) return [...data];\n        const dm = data[index];\n        return [dm, ...data.filter(d => d.id !== dmId)];\n      });\n    });\n    return () => {\n      socket.emit(\"leaveRoom\", current === null || current === void 0 ? void 0 : current.id);\n      socket.disconnect();\n    };\n  }, [current, cache]);\n}\n\n_s(useDMSocket, \"yKPUtBryQjcykj4wN076+QCSH/g=\", false, function () {\n  return [useQueryClient];\n});","map":{"version":3,"sources":["/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/src/api/ws/useDMSocket.js"],"names":["useEffect","getSocket","useQueryClient","userStore","dmKey","useDMSocket","current","state","cache","socket","emit","id","on","dmId","setQueryData","data","index","findIndex","d","dm","filter","disconnect"],"mappings":";;AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,OAAOC,SAAP,MAAsB,cAAtB;AACA,SAASC,cAAT,QAA+B,aAA/B;AACA,OAAOC,SAAP,MAAsB,kBAAtB;AACA,SAASC,KAAT,QAAsB,iBAAtB;AAEA,eAAe,SAASC,WAAT,GAAuB;AAAA;;AACpC,QAAMC,OAAO,GAAGH,SAAS,CAAEI,KAAD,IAAWA,KAAK,CAACD,OAAlB,CAAzB;AACA,QAAME,KAAK,GAAGN,cAAc,EAA5B;AAEAF,EAAAA,SAAS,CAAC,MAAM;AACd,UAAMS,MAAM,GAAGR,SAAS,EAAxB;AACAQ,IAAAA,MAAM,CAACC,IAAP,CAAY,UAAZ,EAAwBJ,OAAxB,aAAwBA,OAAxB,uBAAwBA,OAAO,CAAEK,EAAjC;AAEAF,IAAAA,MAAM,CAACG,EAAP,CAAU,aAAV,EAA0BC,IAAD,IAAU;AACjCL,MAAAA,KAAK,CAACM,YAAN,CAAmBV,KAAnB,EAA2BW,IAAD,IAAU;AAClC,cAAMC,KAAK,GAAGD,IAAH,aAAGA,IAAH,uBAAGA,IAAI,CAAEE,SAAN,CAAiBC,CAAD,IAAOA,CAAC,CAACP,EAAF,KAASE,IAAhC,CAAd;AACA,YAAIG,KAAK,KAAK,CAAV,IAAeA,KAAK,KAAK,CAAC,CAA9B,EAAiC,OAAO,CAAC,GAAGD,IAAJ,CAAP;AACjC,cAAMI,EAAE,GAAGJ,IAAI,CAACC,KAAD,CAAf;AACA,eAAO,CAACG,EAAD,EAAK,GAAGJ,IAAI,CAACK,MAAL,CAAaF,CAAD,IAAOA,CAAC,CAACP,EAAF,KAASE,IAA5B,CAAR,CAAP;AACD,OALD;AAMD,KAPD;AASA,WAAO,MAAM;AACXJ,MAAAA,MAAM,CAACC,IAAP,CAAY,WAAZ,EAAyBJ,OAAzB,aAAyBA,OAAzB,uBAAyBA,OAAO,CAAEK,EAAlC;AACAF,MAAAA,MAAM,CAACY,UAAP;AACD,KAHD;AAID,GAjBQ,EAiBN,CAACf,OAAD,EAAUE,KAAV,CAjBM,CAAT;AAkBD;;GAtBuBH,W;UAERH,c","sourcesContent":["import { useEffect } from \"react\";\nimport getSocket from \"../getSocket\";\nimport { useQueryClient } from \"react-query\";\nimport userStore from \"stores/userStore\";\nimport { dmKey } from \"utils/querykeys\";\n\nexport default function useDMSocket() {\n  const current = userStore((state) => state.current);\n  const cache = useQueryClient();\n\n  useEffect(() => {\n    const socket = getSocket();\n    socket.emit(\"joinUser\", current?.id);\n\n    socket.on(\"push_to_top\", (dmId) => {\n      cache.setQueryData(dmKey, (data) => {\n        const index = data?.findIndex((d) => d.id === dmId);\n        if (index === 0 || index === -1) return [...data];\n        const dm = data[index];\n        return [dm, ...data.filter((d) => d.id !== dmId)];\n      });\n    });\n\n    return () => {\n      socket.emit(\"leaveRoom\", current?.id);\n      socket.disconnect();\n    };\n  }, [current, cache]);\n}\n"]},"metadata":{},"sourceType":"module"}