{"ast":null,"code":"import _regeneratorRuntime from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{Avatar,Box,Button,Divider,Flex,IconButton,LightMode,Modal,ModalBody,ModalCloseButton,ModalContent,ModalFooter,ModalHeader,ModalOverlay,Text,Tooltip,useDisclosure}from\"@chakra-ui/react\";import{deleteGuild,editGuild,getBanList,invalidateInviteLinks,unbanMember}from\"api/handler/guilds\";import{Form,Formik}from\"formik\";import React,{useRef,useState}from\"react\";import{BiUnlink}from\"react-icons/bi\";import{FaRegTrashAlt}from\"react-icons/fa\";import{ImHammer2}from\"react-icons/im\";import{IoCheckmarkCircle,IoPersonRemove}from\"react-icons/io5\";import{useQuery,useQueryClient}from\"react-query\";import useGetCurrentGuild from\"hooks/useGetCurrentGuild\";import toErrorMap from\"utils/toErrorMap\";import{GuildSchema}from\"validation/guild.schema\";import channelScrollbarCss from\"../layouts/guild/css/ChannelScrollerCSS\";import InputField from\"components/shared/InputField\";import CropImageModal from\"./CropImageModal\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function GuildSettingsModal(_ref){var guildId=_ref.guildId,isOpen=_ref.isOpen,onClose=_ref.onClose;var guild=useGetCurrentGuild(guildId);var _useState=useState(\"START\"),_useState2=_slicedToArray(_useState,2),screen=_useState2[0],setScreen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isReset=_useState4[0],setIsReset=_useState4[1];var goBack=function goBack(){return setScreen(\"START\");};var submitClose=function submitClose(){setScreen(\"START\");onClose();};var _useDisclosure=useDisclosure(),cropperIsOpen=_useDisclosure.isOpen,cropperOnOpen=_useDisclosure.onOpen,cropperOnClose=_useDisclosure.onClose;var inputFile=useRef(null);var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),imageUrl=_useState6[0],setImageUrl=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),cropImage=_useState8[0],setCropImage=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),croppedImage=_useState10[0],setCroppedImage=_useState10[1];function handleEditGuild(_x,_x2){return _handleEditGuild.apply(this,arguments);}function _handleEditGuild(){_handleEditGuild=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values,_ref2){var setErrors,resetForm,formData,_yield$editGuild,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setErrors=_ref2.setErrors,resetForm=_ref2.resetForm;_context2.prev=1;formData=new FormData();formData.append(\"name\",values.name);formData.append(\"image\",croppedImage!==null&&croppedImage!==void 0?croppedImage:imageUrl);_context2.next=7;return editGuild(guildId,formData);case 7:_yield$editGuild=_context2.sent;data=_yield$editGuild.data;if(data){resetForm();onClose();}_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](1);setErrors(toErrorMap(_context2.t0));case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[1,12]]);}));return _handleEditGuild.apply(this,arguments);}function applyCrop(file){setImageUrl(URL.createObjectURL(file));setCroppedImage(new File([file],\"icon\"));cropperOnClose();}function handleInvalidateInvites(){return _handleInvalidateInvites.apply(this,arguments);}function _handleInvalidateInvites(){_handleInvalidateInvites=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _yield$invalidateInvi,data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return invalidateInviteLinks(guild.id);case 2:_yield$invalidateInvi=_context3.sent;data=_yield$invalidateInvi.data;if(data){setIsReset(true);}case 5:case\"end\":return _context3.stop();}}},_callee3);}));return _handleInvalidateInvites.apply(this,arguments);}if(!guild)return null;return/*#__PURE__*/_jsxs(Modal,{isOpen:isOpen,onClose:onClose,isCentered:true,children:[/*#__PURE__*/_jsx(ModalOverlay,{}),screen===\"START\"&&/*#__PURE__*/_jsxs(ModalContent,{bg:\"brandGray.light\",children:[/*#__PURE__*/_jsx(Formik,{initialValues:{name:guild.name},validationSchema:GuildSchema,onSubmit:handleEditGuild,children:function children(_ref3){var isSubmitting=_ref3.isSubmitting;return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(ModalHeader,{textAlign:\"center\",fontWeight:\"bold\",pb:0,children:\"Server Overview\"}),/*#__PURE__*/_jsx(ModalCloseButton,{}),/*#__PURE__*/_jsxs(ModalBody,{children:[/*#__PURE__*/_jsxs(Flex,{mb:\"4\",justify:\"center\",children:[/*#__PURE__*/_jsxs(Box,{textAlign:\"center\",children:[/*#__PURE__*/_jsx(Tooltip,{label:\"Change Icon\",\"aria-label\":\"Change Icon\",children:/*#__PURE__*/_jsx(Avatar,{size:\"xl\",name:guild===null||guild===void 0?void 0:guild.name,bg:\"brandGray.darker\",color:\"#fff\",src:imageUrl||\"\",_hover:{cursor:\"pointer\",opacity:0.5},onClick:function onClick(){return inputFile.current.click();}})}),/*#__PURE__*/_jsx(Text,{mt:\"2\",_hover:{cursor:\"pointer\",color:\"brandGray.accent\"},onClick:function onClick(){setCroppedImage(null);setImageUrl(null);},children:\"Remove\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"image\",accept:\"image/*\",ref:inputFile,hidden:true,onChange:/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(e.currentTarget.files){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setCropImage(URL.createObjectURL(e.currentTarget.files[0]));cropperOnOpen();case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x3){return _ref4.apply(this,arguments);};}()})]}),/*#__PURE__*/_jsx(InputField,{label:\"server name\",name:\"name\"}),/*#__PURE__*/_jsx(Divider,{my:\"4\"}),/*#__PURE__*/_jsx(Text,{fontWeight:\"semibold\",mb:2,children:\"Additional Configuration\"}),/*#__PURE__*/_jsxs(Flex,{align:\"center\",justify:\"space-between\",mb:\"2\",children:[/*#__PURE__*/_jsx(Button,{onClick:handleInvalidateInvites,fontSize:\"14px\",rightIcon:isReset?/*#__PURE__*/_jsx(IoCheckmarkCircle,{}):/*#__PURE__*/_jsx(BiUnlink,{}),colorScheme:isReset?\"green\":\"gray\",children:\"Invalidate Links\"}),/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setScreen(\"BANLIST\");},fontSize:\"14px\",rightIcon:/*#__PURE__*/_jsx(ImHammer2,{}),children:\"Bans\"})]}),/*#__PURE__*/_jsx(Flex,{align:\"center\",justify:\"space-between\",mb:\"2\",children:/*#__PURE__*/_jsx(LightMode,{children:/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return setScreen(\"CONFIRM\");},colorScheme:\"red\",variant:\"ghost\",fontSize:\"14px\",textColor:\"menuRed\",rightIcon:/*#__PURE__*/_jsx(FaRegTrashAlt,{}),children:\"Delete Server\"})})})]}),/*#__PURE__*/_jsxs(ModalFooter,{bg:\"brandGray.dark\",children:[/*#__PURE__*/_jsx(Button,{onClick:onClose,mr:6,variant:\"link\",fontSize:\"14px\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{background:\"highlight.standard\",color:\"white\",type:\"submit\",_hover:{bg:\"highlight.hover\"},_active:{bg:\"highlight.active\"},_focus:{boxShadow:\"none\"},isLoading:isSubmitting,fontSize:\"14px\",children:\"Save Changes\"})]})]});}}),cropperIsOpen&&/*#__PURE__*/_jsx(CropImageModal,{isOpen:cropperIsOpen,onClose:cropperOnClose,initialImage:cropImage,applyCrop:applyCrop})]}),screen===\"CONFIRM\"&&/*#__PURE__*/_jsx(DeleteGuildModal,{goBack:goBack,submitClose:submitClose,name:guild.name,guildId:guildId}),screen===\"BANLIST\"&&/*#__PURE__*/_jsx(BanListModal,{goBack:goBack,guildId:guildId})]});}function DeleteGuildModal(_ref5){var goBack=_ref5.goBack,submitClose=_ref5.submitClose,name=_ref5.name,guildId=_ref5.guildId;function handleDeleteGuild(){return _handleDeleteGuild.apply(this,arguments);}function _handleDeleteGuild(){_handleDeleteGuild=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:submitClose();_context4.next=3;return deleteGuild(guildId);case 3:case\"end\":return _context4.stop();}}},_callee4);}));return _handleDeleteGuild.apply(this,arguments);}return/*#__PURE__*/_jsxs(ModalContent,{bg:\"brandGray.light\",children:[/*#__PURE__*/_jsxs(ModalHeader,{fontWeight:\"bold\",pb:\"0\",children:[\"Delete \",name]}),/*#__PURE__*/_jsx(ModalBody,{pb:3,children:/*#__PURE__*/_jsxs(Text,{children:[\"Are you sure you want to delete \",/*#__PURE__*/_jsx(\"b\",{children:name}),\"? This cannot be undone.\"]})}),/*#__PURE__*/_jsxs(ModalFooter,{bg:\"brandGray.dark\",children:[/*#__PURE__*/_jsx(Button,{mr:6,variant:\"link\",onClick:goBack,fontSize:\"14px\",children:\"Cancel\"}),/*#__PURE__*/_jsx(LightMode,{children:/*#__PURE__*/_jsx(Button,{colorScheme:\"red\",fontSize:\"14px\",onClick:handleDeleteGuild,children:\"Delete Server\"})})]})]});}function BanListModal(_ref6){var goBack=_ref6.goBack,guildId=_ref6.guildId;var key=\"bans-\".concat(guildId);var _useQuery=useQuery(key,function(){return getBanList(guildId).then(function(response){return response.data;});}),data=_useQuery.data;var cache=useQueryClient();var unbanUser=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(id){var _yield$unbanMember,data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return unbanMember(guildId,id);case 2:_yield$unbanMember=_context5.sent;data=_yield$unbanMember.data;if(data){cache.setQueryData(key,function(d){return d===null||d===void 0?void 0:d.filter(function(b){return b.id!==id;});});}case 5:case\"end\":return _context5.stop();}}},_callee5);}));return function unbanUser(_x4){return _ref7.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(ModalContent,{bg:\"brandGray.light\",maxH:\"500px\",children:[/*#__PURE__*/_jsxs(ModalHeader,{fontWeight:\"bold\",pb:\"0\",children:[data===null||data===void 0?void 0:data.length,\" Bans\"]}),/*#__PURE__*/_jsxs(ModalBody,{pb:3,overflowY:\"auto\",css:channelScrollbarCss,children:[/*#__PURE__*/_jsx(Text,{mb:2,children:\"Bans are by account. Click on the icon to unban.\"}),data===null||data===void 0?void 0:data.map(function(m){return/*#__PURE__*/_jsxs(Flex,{p:\"3\",_hover:{bg:\"brandGray.dark\",borderRadius:\"5px\"},align:\"center\",justify:\"space-between\",children:[/*#__PURE__*/_jsxs(Flex,{align:\"center\",w:\"full\",children:[/*#__PURE__*/_jsx(Avatar,{size:\"sm\",src:m.image}),/*#__PURE__*/_jsx(Text,{ml:\"2\",children:m.username})]}),/*#__PURE__*/_jsx(IconButton,{icon:/*#__PURE__*/_jsx(IoPersonRemove,{}),borderRadius:\"50%\",\"aria-label\":\"unban user\",onClick:/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(e){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:e.preventDefault();_context6.next=3;return unbanUser(m.id);case 3:case\"end\":return _context6.stop();}}},_callee6);}));return function(_x5){return _ref8.apply(this,arguments);};}()})]});}),(data===null||data===void 0?void 0:data.length)===0&&/*#__PURE__*/_jsx(Text,{children:\"No bans yet.\"})]}),/*#__PURE__*/_jsx(ModalFooter,{bg:\"brandGray.dark\",children:/*#__PURE__*/_jsx(Button,{mr:6,variant:\"link\",onClick:goBack,fontSize:\"14px\",children:\"Back\"})})]});}","map":{"version":3,"sources":["/Users/paulndam/Documents/MERN/React-Course/Crash-Course/build-discord/client/src/components/modals/GuildSettingsModal.js"],"names":["Avatar","Box","Button","Divider","Flex","IconButton","LightMode","Modal","ModalBody","ModalCloseButton","ModalContent","ModalFooter","ModalHeader","ModalOverlay","Text","Tooltip","useDisclosure","deleteGuild","editGuild","getBanList","invalidateInviteLinks","unbanMember","Form","Formik","React","useRef","useState","BiUnlink","FaRegTrashAlt","ImHammer2","IoCheckmarkCircle","IoPersonRemove","useQuery","useQueryClient","useGetCurrentGuild","toErrorMap","GuildSchema","channelScrollbarCss","InputField","CropImageModal","GuildSettingsModal","guildId","isOpen","onClose","guild","screen","setScreen","isReset","setIsReset","goBack","submitClose","cropperIsOpen","cropperOnOpen","onOpen","cropperOnClose","inputFile","imageUrl","setImageUrl","cropImage","setCropImage","croppedImage","setCroppedImage","handleEditGuild","values","setErrors","resetForm","formData","FormData","append","name","data","applyCrop","file","URL","createObjectURL","File","handleInvalidateInvites","id","isSubmitting","cursor","opacity","current","click","color","e","currentTarget","files","bg","boxShadow","DeleteGuildModal","handleDeleteGuild","BanListModal","key","then","response","cache","unbanUser","setQueryData","d","filter","b","length","map","m","borderRadius","image","username","preventDefault"],"mappings":"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","sourcesContent":["import {\n  Avatar,\n  Box,\n  Button,\n  Divider,\n  Flex,\n  IconButton,\n  LightMode,\n  Modal,\n  ModalBody,\n  ModalCloseButton,\n  ModalContent,\n  ModalFooter,\n  ModalHeader,\n  ModalOverlay,\n  Text,\n  Tooltip,\n  useDisclosure,\n} from \"@chakra-ui/react\";\nimport {\n  deleteGuild,\n  editGuild,\n  getBanList,\n  invalidateInviteLinks,\n  unbanMember,\n} from \"api/handler/guilds\";\nimport { Form, Formik } from \"formik\";\nimport React, { useRef, useState } from \"react\";\nimport { BiUnlink } from \"react-icons/bi\";\nimport { FaRegTrashAlt } from \"react-icons/fa\";\nimport { ImHammer2 } from \"react-icons/im\";\nimport { IoCheckmarkCircle, IoPersonRemove } from \"react-icons/io5\";\nimport { useQuery, useQueryClient } from \"react-query\";\nimport useGetCurrentGuild from \"hooks/useGetCurrentGuild\";\nimport toErrorMap from \"utils/toErrorMap\";\nimport { GuildSchema } from \"validation/guild.schema\";\nimport channelScrollbarCss from \"../layouts/guild/css/ChannelScrollerCSS\";\nimport InputField from \"components/shared/InputField\";\nimport CropImageModal from \"./CropImageModal\";\n\nexport default function GuildSettingsModal({ guildId, isOpen, onClose }) {\n  const guild = useGetCurrentGuild(guildId);\n  const [screen, setScreen] = useState(\"START\");\n  const [isReset, setIsReset] = useState(false);\n\n  const goBack = () => setScreen(\"START\");\n  const submitClose = () => {\n    setScreen(\"START\");\n    onClose();\n  };\n\n  const {\n    isOpen: cropperIsOpen,\n    onOpen: cropperOnOpen,\n    onClose: cropperOnClose,\n  } = useDisclosure();\n\n  const inputFile = useRef(null);\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [cropImage, setCropImage] = useState(\"\");\n  const [croppedImage, setCroppedImage] = useState(null);\n\n  async function handleEditGuild(values, { setErrors, resetForm }) {\n    try {\n      const formData = new FormData();\n      formData.append(\"name\", values.name);\n      formData.append(\"image\", croppedImage ?? imageUrl);\n      const { data } = await editGuild(guildId, formData);\n      if (data) {\n        resetForm();\n        onClose();\n      }\n    } catch (error) {\n      setErrors(toErrorMap(error));\n    }\n  }\n\n  function applyCrop(file) {\n    setImageUrl(URL.createObjectURL(file));\n    setCroppedImage(new File([file], \"icon\"));\n    cropperOnClose();\n  }\n\n  async function handleInvalidateInvites() {\n    const { data } = await invalidateInviteLinks(guild.id);\n\n    if (data) {\n      setIsReset(true);\n    }\n  }\n\n  if (!guild) return null;\n\n  return (\n    <Modal isOpen={isOpen} onClose={onClose} isCentered>\n      <ModalOverlay />\n      {screen === \"START\" && (\n        <ModalContent bg=\"brandGray.light\">\n          <Formik\n            initialValues={{\n              name: guild.name,\n            }}\n            validationSchema={GuildSchema}\n            onSubmit={handleEditGuild}\n          >\n            {({ isSubmitting }) => (\n              <Form>\n                <ModalHeader textAlign=\"center\" fontWeight=\"bold\" pb={0}>\n                  Server Overview\n                </ModalHeader>\n                <ModalCloseButton />\n                <ModalBody>\n                  <Flex mb=\"4\" justify=\"center\">\n                    <Box textAlign={\"center\"}>\n                      <Tooltip label=\"Change Icon\" aria-label=\"Change Icon\">\n                        <Avatar\n                          size=\"xl\"\n                          name={guild?.name}\n                          bg={\"brandGray.darker\"}\n                          color={\"#fff\"}\n                          src={imageUrl || \"\"}\n                          _hover={{ cursor: \"pointer\", opacity: 0.5 }}\n                          onClick={() => inputFile.current.click()}\n                        />\n                      </Tooltip>\n                      <Text\n                        mt={\"2\"}\n                        _hover={{\n                          cursor: \"pointer\",\n                          color: \"brandGray.accent\",\n                        }}\n                        onClick={() => {\n                          setCroppedImage(null);\n                          setImageUrl(null);\n                        }}\n                      >\n                        Remove\n                      </Text>\n                    </Box>\n                    <input\n                      type=\"file\"\n                      name=\"image\"\n                      accept=\"image/*\"\n                      ref={inputFile}\n                      hidden\n                      onChange={async (e) => {\n                        if (!e.currentTarget.files) return;\n                        setCropImage(\n                          URL.createObjectURL(e.currentTarget.files[0])\n                        );\n                        cropperOnOpen();\n                      }}\n                    />\n                  </Flex>\n\n                  <InputField label=\"server name\" name=\"name\" />\n\n                  <Divider my={\"4\"} />\n\n                  <Text fontWeight={\"semibold\"} mb={2}>\n                    Additional Configuration\n                  </Text>\n\n                  <Flex align={\"center\"} justify={\"space-between\"} mb={\"2\"}>\n                    <Button\n                      onClick={handleInvalidateInvites}\n                      fontSize={\"14px\"}\n                      rightIcon={isReset ? <IoCheckmarkCircle /> : <BiUnlink />}\n                      colorScheme={isReset ? \"green\" : \"gray\"}\n                    >\n                      Invalidate Links\n                    </Button>\n                    <Button\n                      onClick={() => setScreen(\"BANLIST\")}\n                      fontSize={\"14px\"}\n                      rightIcon={<ImHammer2 />}\n                    >\n                      Bans\n                    </Button>\n                  </Flex>\n                  <Flex align={\"center\"} justify={\"space-between\"} mb={\"2\"}>\n                    <LightMode>\n                      <Button\n                        onClick={() => setScreen(\"CONFIRM\")}\n                        colorScheme={\"red\"}\n                        variant=\"ghost\"\n                        fontSize={\"14px\"}\n                        textColor={\"menuRed\"}\n                        rightIcon={<FaRegTrashAlt />}\n                      >\n                        Delete Server\n                      </Button>\n                    </LightMode>\n                  </Flex>\n                </ModalBody>\n\n                <ModalFooter bg=\"brandGray.dark\">\n                  <Button\n                    onClick={onClose}\n                    mr={6}\n                    variant=\"link\"\n                    fontSize={\"14px\"}\n                  >\n                    Cancel\n                  </Button>\n                  <Button\n                    background=\"highlight.standard\"\n                    color=\"white\"\n                    type=\"submit\"\n                    _hover={{ bg: \"highlight.hover\" }}\n                    _active={{ bg: \"highlight.active\" }}\n                    _focus={{ boxShadow: \"none\" }}\n                    isLoading={isSubmitting}\n                    fontSize={\"14px\"}\n                  >\n                    Save Changes\n                  </Button>\n                </ModalFooter>\n              </Form>\n            )}\n          </Formik>\n          {cropperIsOpen && (\n            <CropImageModal\n              isOpen={cropperIsOpen}\n              onClose={cropperOnClose}\n              initialImage={cropImage}\n              applyCrop={applyCrop}\n            />\n          )}\n        </ModalContent>\n      )}\n      {screen === \"CONFIRM\" && (\n        <DeleteGuildModal\n          goBack={goBack}\n          submitClose={submitClose}\n          name={guild.name}\n          guildId={guildId}\n        />\n      )}\n      {screen === \"BANLIST\" && (\n        <BanListModal goBack={goBack} guildId={guildId} />\n      )}\n    </Modal>\n  );\n}\n\nfunction DeleteGuildModal({ goBack, submitClose, name, guildId }) {\n  async function handleDeleteGuild() {\n    submitClose();\n    await deleteGuild(guildId);\n  }\n\n  return (\n    <ModalContent bg=\"brandGray.light\">\n      <ModalHeader fontWeight=\"bold\" pb=\"0\">\n        Delete {name}\n      </ModalHeader>\n      <ModalBody pb={3}>\n        <Text>\n          Are you sure you want to delete <b>{name}</b>? This cannot be undone.\n        </Text>\n      </ModalBody>\n\n      <ModalFooter bg=\"brandGray.dark\">\n        <Button mr={6} variant=\"link\" onClick={goBack} fontSize={\"14px\"}>\n          Cancel\n        </Button>\n        <LightMode>\n          <Button\n            colorScheme=\"red\"\n            fontSize={\"14px\"}\n            onClick={handleDeleteGuild}\n          >\n            Delete Server\n          </Button>\n        </LightMode>\n      </ModalFooter>\n    </ModalContent>\n  );\n}\n\nfunction BanListModal({ goBack, guildId }) {\n  const key = `bans-${guildId}`;\n  const { data } = useQuery(key, () =>\n    getBanList(guildId).then((response) => response.data)\n  );\n  const cache = useQueryClient();\n\n  const unbanUser = async (id) => {\n    const { data } = await unbanMember(guildId, id);\n    if (data) {\n      cache.setQueryData(key, (d) => {\n        return d?.filter((b) => b.id !== id);\n      });\n    }\n  };\n\n  return (\n    <ModalContent bg=\"brandGray.light\" maxH={\"500px\"}>\n      <ModalHeader fontWeight=\"bold\" pb=\"0\">\n        {data?.length} Bans\n      </ModalHeader>\n      <ModalBody pb={3} overflowY={\"auto\"} css={channelScrollbarCss}>\n        <Text mb={2}>Bans are by account. Click on the icon to unban.</Text>\n\n        {data?.map((m) => (\n          <Flex\n            p={\"3\"}\n            _hover={{\n              bg: \"brandGray.dark\",\n              borderRadius: \"5px\",\n            }}\n            align=\"center\"\n            justify=\"space-between\"\n          >\n            <Flex align=\"center\" w={\"full\"}>\n              <Avatar size=\"sm\" src={m.image} />\n              <Text ml=\"2\">{m.username}</Text>\n            </Flex>\n            <IconButton\n              icon={<IoPersonRemove />}\n              borderRadius=\"50%\"\n              aria-label=\"unban user\"\n              onClick={async (e) => {\n                e.preventDefault();\n                await unbanUser(m.id);\n              }}\n            />\n          </Flex>\n        ))}\n        {data?.length === 0 && <Text>No bans yet.</Text>}\n      </ModalBody>\n\n      <ModalFooter bg=\"brandGray.dark\">\n        <Button mr={6} variant=\"link\" onClick={goBack} fontSize={\"14px\"}>\n          Back\n        </Button>\n      </ModalFooter>\n    </ModalContent>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}